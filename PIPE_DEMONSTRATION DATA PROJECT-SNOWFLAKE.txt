
#CREATING A DATABASE
CREATE OR REPLACE DATABASE SNOWDATA;

#CREATING A TABLE
CREATE OR REPLACE TABLE SNOWDATA.PUBLIC.SNOWFIRST(id int,first_name string,last_name string,email string,location string,department string);

#CREATING A PROPER FILE FORMAT
create schema fileformat;
create or replace FILE FORMAT SNOWDATA.fileformat.csv_fileformat
type=csv
field_delimiter=','
skip_header=1
null_if=('null','null')
empty_field_as_null=true;

#CREATE A EXTERNAL STAGE SCHEMA FOR THE AWS STAGES
CREATE OR REPLACE SCHEMA EXTERNAL_STAGE;

#CREATE AN INTEGRATION OBJECT
CREATE OR REPLACE STORAGE INTEGRATION S3_INT
TYPE=EXTERNAL_STAGE
STORAGE_PROVIDER=S3
ENABLED=TRUE
STORAGE_AWS_ROLE_ARN='arn:aws:iam::992382487313:role/SNOWFLAKEROLE1'
STORAGE_ALLOWED_LOCATIONS=('S3://snowflakebucketsaif/csv');

desc integration S3_INT;

#CREATE
CREATE OR REPLACE STAGE SNOWDATA.EXTERNAL_STAGE.AWS_STAGE
URL='S3://snowflakebucketsaif/csv'
STORAGE_INTEGRATION=S3_INT
FILE_FORMAT=SNOWDATA.fileformat.csv_fileformat;



#CREATION OF PIPES
CREATE SCHEMA PIPES;
CREATE OR REPLACE PIPE SNOWDATA.PIPES.SNOWPIPE1
AUTO_INGEST=TRUE
AS
COPY INTO SNOWDATA.PUBLIC.SNOWFIRST
FROM @SNOWDATA.EXTERNAL_STAGE.AWS_STAGE;

SELECT * FROM SNOWFIRST;

DESC PIPE SNOWPIPE1;